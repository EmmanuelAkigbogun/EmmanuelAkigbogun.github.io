<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Static&spades;&star;&hearts;&dagger;gb</title>
    <style>
        .b{
            display: flex;
            justify-content: center;
        }
        #t{
            width: 85vw;
            height: 70vh;
            background-color: purple;
            color: white;
        }
        #t::placeholder{
            color: white;
            font-size: 1rem;
        }
        .c{
            background-color: purple;
            color: white;
            width: 25vw;
            height: 7vh;
            font-size: 1rem;
            border-radius: 6px;
            margin:5px;
        }
        .v{
            color: purple;
         }
         #l{
             width: 45vw;
         }
    </style>
</head>
<body class="b">
    <section>
        <textarea id="t" placeholder="speech to text"></textarea>
        <section id="v" class="v"></section>
        <section class="b">
            <button id="s" class="c">start</button>
            <button id="c" class="c">copy</button>
            <button id="e" class="c">stop</button>
    </section>
            <section class="b">
              <button id="l" class="c">redo last line(s)</button>
        </section>
    </section>
    <script>
        a="";
        j=[];
        q=[];
        g=false;
        z="";
        happy=(x)=>{
            navigator.clipboard.writeText(x);
        }
        c.onclick=()=>{
            happy(t.innerHTML);
            z=v.innerHTML;
            v.innerHTML="copied";
            setTimeout(()=>{
            v.innerHTML=z;
            },2000)
        }
        s.onclick=()=>{
            t.innerHTML="";
            g=true;
            window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const r= new SpeechRecognition();
            r.lang="en-gb"
            r.interimResults=true;
            console.log(r)
            r.onresult=(e)=>{
                const transcript=Array.from(e.results)
                .map(result=>result[0])
                .map(result=>result.transcript)
                .join("");
                console.log(transcript);
                j=a.split("\n");
                k=[];
                for(i of j){
                   if(i.trim()==""){
                   }
                   else{
                       k.push(i);
                   }
                }
                a=k.join("\n");
                
               if(g){
if(a==""){ t.innerHTML=transcript}
else{
 t.innerHTML=a+"\n"+transcript;}}

            }
            r.onend=()=>{
                if(g){
                   
 v.innerHTML="Speak...";
                    r.start();
                    a=t.innerHTML;
                }
            }
            e.onclick=()=>{
                a="";
                t.innerHTML="";
                v.innerHTML="";
                g=false;
                z="";
            }    
            l.onclick=()=>{
                q=a.split("\n");
                q.pop();
                a=q.join("\n");
            } 
            v.innerHTML="Speak...";
            r.start();
        }
        t.onfocus=()=>{
            c.focus();
        }
         t.style.font=getComputedStyle(c).font;
    </script>
</body>
</html>